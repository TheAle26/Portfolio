{% load static %}
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <!-- Viewport correcto para móvil -->
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <link rel="shortcut icon" type="image/ico" href="{% static 'img/logo.ico' %}">
    <title>FarmaGo</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link href="{% static 'css/style.css' %}" rel="stylesheet" />
  </head>
  <body class="d-flex flex-column min-vh-100 bg-light">
    <nav class="navbar navbar-expand-md navbar-dark bg-primary">
      <div class="container-fluid">
        <a class="navbar-brand fw-semibold" href="/">FarmaGo</a>

        <!-- Botón hamburguesa en móvil -->
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navMain"
          aria-controls="navMain"
          aria-expanded="false"
          aria-label="Mostrar menú"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Links que colapsan en móvil -->
        <div class="collapse navbar-collapse" id="navMain">
          <ul class="navbar-nav ms-auto">
            {% if user.is_authenticated %}
              {% if user.cliente %}
              <li class="nav-item d-flex align-items-center">
                <a class="cart-button" href="{% url 'ver_carrito' %}" aria-label="Ver carrito">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-cart" viewBox="0 0 16 16">
                    <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM3.102 4l1.313 7h8.17l1.313-7H3.102zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                  </svg>
                  <span class="cart-text d-none d-sm-inline">Carrito</span>
                  {% if cart_item_count > 0 %}
                    <span class="cart-pill">
                      {{ cart_item_count }}
                    </span>
                  {% endif %}
                </a>
              </li>
              {% endif %}

              <li class="nav-item d-flex align-items-center"> <a
                  class="nav-link btn btn-link text-white" href="{% url 'panel_redireccion' %}"
                >
                  Panel
                </a>
              </li>

              <li class="nav-item d-flex align-items-center">
                <form action="{% url 'logout' %}" method="post" class="d-inline">
                  {% csrf_token %}
                  <button
                    type="submit"
                    class="nav-link btn btn-link p-0 text-white"
                    style="text-decoration: none"
                  >
                    Salir
                  </button>
                </form>
              </li>
              
            {% else %}
              <li class="nav-item">
                <a class="nav-link" href="{% url 'login' %}">Ingresar</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{% url 'registro_selector' %}"
                  >Registrarse</a
                >
              </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>
    {% comment %} para el mensajito de alertas {% endcomment %}
    <div
      class="toast-container position-fixed top-0 start-50 translate-middle-x p-3"
    >
      {% for message in messages %}
      <div
        id="toast-{{ forloop.counter }}"
        class="toast align-items-center text-bg-{{ message.tags }} border-0"
        role="alert"
        aria-live="assertive"
        aria-atomic="true"
      >
        <div class="d-flex">
          <div class="toast-body">{{ message }}</div>
          <button
            type="button"
            class="btn-close btn-close-white me-2 m-auto"
            data-bs-dismiss="toast"
            aria-label="Close"
          ></button>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Contenedor con padding adecuado en móvil -->
    <main class="flex-grow-1 container py-3 py-md-4">
      {% block content %}{% endblock %}
    </main>
    {% block extra_footer %}{% endblock %}
    <!-- Footer simple (toca para ocultar si no lo usás) -->
    <footer class="mt-auto py-3 border-top bg-white">
      <div class="container text-center small text-muted">
        © {{ now|date:"Y" }} FarmaGo
      </div>
    </footer>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Selecciona todos los elementos con la clase 'toast' (los mensajes de Django)
        const toastElList = [].slice.call(document.querySelectorAll(".toast"));

        // Itera sobre ellos y los inicializa/muestra
        toastElList.map(function (toastEl) {
          // Inicializa el objeto Toast de Bootstrap
          const toast = new bootstrap.Toast(toastEl, {
            autohide: true,
            delay: 7000, // Ocultar después de 7 segundos
          });
          // Muestra la Toast
          toast.show();
        });
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    {% block extra_js %}{% endblock %}
    {% block extra_js_bottom %}{% endblock %}
  </body>
</html>